{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FSH</title>
  <link rel="stylesheet" href="{% static 'styles/style.css' %}">
</head>
<body>
  <div class="name-bar">
    <h1><img src="{% static 'images/logo3.png' %}"class='logo-img'> </h1>
  </div>


<div class="top-bar">
  {% if user.is_authenticated %}
  <div class="user-points">
    <span id="points-display">{{ user.points }}</span> points
  </div>
  {% endif %}
    {% if user.is_authenticated %}
      <div class="profile-container">
        <img src="{% static 'images/loggedin.png' %}" alt="Profile Image" class="profile-img">
        <a href="{% url 'logout' %}" class="login-button">Logout</a>
      </div>
    {% else %}
      <div class="profile-container">
        <img src="{% static 'images/loggedout.jpg' %}" alt="Guest Profile" class="profile-img">
        <a href="{% url 'login' %}" class="login-button">Login</a>
      </div>
    {% endif %}
  </div>
  
  <div class="main-content">

    <div class="top-section">
      <section>
      {% if user.is_authenticated and user.points >= 80 %}
        <img src="{% static 'images/fish5.png' %}" alt="Advanced Fish" class="fish-img fish-img-level5" id="fish-image">
      {% elif user.points >= 60 %}
      <img src="{% static 'images/fish4.png' %}" alt="Advanced Fish" class="fish-img fish-img-level4" id="fish-image">
      {% elif user.points >= 40 %}
      <img src="{% static 'images/fish3.png' %}" alt="Advanced Fish" class="fish-img fish-img-level3" id="fish-image">
      {% elif user.points >= 20 %}
      <img src="{% static 'images/fish2.png' %}" alt="Advanced Fish" class="fish-img fish-img-level2" id="fish-image">
      {% else %}
        <img src="{% static 'images/fish.png' %}" alt="Fish" class="fish-img fish-img-level1" id="fish-image">
      {% endif %}
      </section>
      <button onclick="move()" class="top-button">
        {% if user.is_authenticated and user.points >= 50 %}
          Level 2
        {% else %}
          Level 1
        {% endif %}
      </button>
      <div id="myProgress">
        <div id="myBar"></div>
      </div>
    </div>

  <div class="bottom-buttons">
    <a href="{% url 'calendar' %}" class="button-card">Calendar</a>
    <a href="{% url 'todo_list' %}" class="button-card">To-Do List</a>
    <a href="{% url 'studyTimer' %}" class="button-card">Study Timer</a>
  </div>

</div>
  
  <script>
    // Function to check points and update fish image dynamically
    function checkPointsAndUpdateFish() {
      const pointsDisplay = document.getElementById('points-display');
      const fishImage = document.getElementById('fish-image');
      const levelButton = document.querySelector('.top-button');
      
      if (pointsDisplay && fishImage) {
        const currentPoints = parseInt(pointsDisplay.textContent);
        
        if (currentPoints >= 80) {
          fishImage.src = "{% static 'images/fish5.png' %}";
          levelButton.textContent = "Level 5";
        } else if (currentPoints >= 60) {
          fishImage.src = "{% static 'images/fish4.png' %}";
          levelButton.textContent = "Level 4";
        } else if (currentPoints >= 40){
          fishImage.src = "{%static 'images/fish3.png' %}";
          levelButton.textContent = "Level 3";
        } else if (currentPoints >= 20) {
          fishImage.src = "{% static 'images/fish2.png' %}";
          levelButton.textContent = "Level 2";
        }else{ 
          fishImage.src = "{% static 'images/fish.png' %}";
          levelButton.textContent = "Level 1";
        }
      }
    }
    
    // Call once on page load
    document.addEventListener('DOMContentLoaded', checkPointsAndUpdateFish);
    
    // Set up an observer to watch for points changes
    const pointsObserver = new MutationObserver(checkPointsAndUpdateFish);
    const pointsDisplay = document.getElementById('points-display');
    
    if (pointsDisplay) {
      pointsObserver.observe(pointsDisplay, { 
        childList: true,
        characterData: true,
        subtree: true 
      });
    }
  </script>

  <script src="{% static 'js/script.js' %}"></script>
</body>
</html>